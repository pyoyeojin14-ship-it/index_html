<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ê¸ˆì§€ì–´ ëŸ¬ì‹œì•ˆ ë£°ë ›</title>
  <style>
    :root{
      --bg:#0f1220;
      --card:#171a2b;
      --card2:#1f2340;
      --text:#eef1ff;
      --muted:#aeb6e5;
      --line:rgba(255,255,255,.12);
      --accent:#7c5cff;
      --good:#2bd576;
      --bad:#ff4d6d;
      --warn:#ffcc00;
    }
    *{box-sizing:border-box}
    body{
      margin:0; background: radial-gradient(900px 600px at 20% 0%, rgba(124,92,255,.18), transparent 60%),
                          radial-gradient(800px 600px at 90% 10%, rgba(43,213,118,.12), transparent 55%),
                          var(--bg);
      color:var(--text); font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      padding:18px;
    }
    .wrap{max-width:980px; margin:0 auto}
    header{
      display:flex; gap:12px; align-items:center; justify-content:space-between;
      margin-bottom:14px;
    }
    .title h1{margin:0; font-size:20px; letter-spacing:.2px}
    .title p{margin:6px 0 0; color:var(--muted); font-size:13px}
    .row{display:grid; grid-template-columns: 1.1fr .9fr; gap:14px}
    @media (max-width: 900px){ .row{grid-template-columns: 1fr} }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.04), transparent 40%),
                  linear-gradient(180deg, var(--card), var(--card2));
      border:1px solid var(--line);
      border-radius:18px;
      padding:14px;
      box-shadow: 0 14px 40px rgba(0,0,0,.28);
    }
    .card h2{margin:0 0 10px; font-size:15px}
    .muted{color:var(--muted); font-size:12px}
    .grid2{display:grid; grid-template-columns:1fr 1fr; gap:10px}
    @media (max-width: 520px){ .grid2{grid-template-columns:1fr} }

    input, textarea, select{
      width:100%;
      background: rgba(255,255,255,.06);
      border:1px solid var(--line);
      color:var(--text);
      border-radius:12px;
      padding:10px 10px;
      outline:none;
      font-size:14px;
    }
    textarea{min-height:96px; resize:vertical}
    label{display:block; font-size:12px; color:var(--muted); margin:8px 0 6px}

    .btns{display:flex; flex-wrap:wrap; gap:8px; margin-top:10px}
    button{
      border:1px solid var(--line);
      background: rgba(255,255,255,.08);
      color:var(--text);
      padding:10px 12px;
      border-radius:999px;
      cursor:pointer;
      font-weight:700;
      font-size:13px;
      transition:.12s transform, .12s opacity, .12s background;
    }
    button:hover{transform: translateY(-1px); background: rgba(255,255,255,.12)}
    button.primary{
      background: rgba(124,92,255,.20);
      border-color: rgba(124,92,255,.40);
    }
    button.danger{
      background: rgba(255,77,109,.16);
      border-color: rgba(255,77,109,.35);
    }
    button.good{
      background: rgba(43,213,118,.14);
      border-color: rgba(43,213,118,.35);
    }
    button:disabled{opacity:.5; cursor:not-allowed; transform:none}

    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.06);
      font-size:12px;
      color:var(--muted);
      margin:6px 6px 0 0;
    }
    .pill b{color:var(--text)}
    .hr{height:1px; background: var(--line); margin:12px 0}

    .assignWrap{display:flex; gap:10px; align-items:stretch; flex-wrap:wrap}
    .assignWrap > * {flex:1}
    .big{
      font-size:18px; font-weight:900; letter-spacing:.3px;
    }

    .timerBox{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      padding:12px;
      border-radius:16px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.06);
    }
    .timerBox .t{
      display:flex; flex-direction:column; gap:4px;
    }
    .timerBox .time{
      font-size:20px; font-weight:900;
    }

    .result{
      border:1px solid var(--line);
      background: rgba(0,0,0,.18);
      border-radius:16px;
      padding:12px;
    }
    .result .headline{font-weight:900; font-size:14px}
    .result .desc{color:var(--muted); font-size:12px; margin-top:6px; line-height:1.45}

    .list{
      display:grid; gap:8px;
    }
    .item{
      border:1px solid var(--line);
      background: rgba(255,255,255,.05);
      border-radius:14px;
      padding:10px;
      display:flex; justify-content:space-between; gap:10px; align-items:flex-start;
    }
    .item .left{display:flex; flex-direction:column; gap:4px}
    .item .who{font-weight:900}
    .tag{
      font-size:11px; padding:4px 8px; border-radius:999px; border:1px solid var(--line);
      color:var(--muted);
      white-space:nowrap;
    }
    .tag.bad{border-color: rgba(255,77,109,.35); background: rgba(255,77,109,.14); color:#ffd1db}
    .tag.warn{border-color: rgba(255,204,0,.35); background: rgba(255,204,0,.12); color:#ffeaa7}
    .tag.good{border-color: rgba(43,213,118,.35); background: rgba(43,213,118,.12); color:#caffdf}

    footer{margin-top:14px; color:var(--muted); font-size:12px; line-height:1.5}
    .kbd{font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size:11px; padding:2px 6px; border:1px solid var(--line); border-radius:8px; background: rgba(255,255,255,.06); color:var(--text)}
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="title">
        <h1>ê¸ˆì§€ì–´ ëŸ¬ì‹œì•ˆ ë£°ë ›</h1>
        <p>ì¹œêµ¬ë“¤ íŒŒí‹°ìš© + í¬íŠ¸í´ë¦¬ì˜¤ìš©. ê¸ˆì§€ì–´ ë°°ì • â†’ íƒ€ì´ë¨¸ â†’ ë£°ë › ë²Œì¹™.</p>
      </div>
      <div>
        <button id="btnSave" class="good">ì €ì¥</button>
        <button id="btnLoad">ë¶ˆëŸ¬ì˜¤ê¸°</button>
        <button id="btnReset" class="danger">ì´ˆê¸°í™”</button>
      </div>
    </header>

    <div class="row">
      <!-- LEFT -->
      <section class="card">
        <h2>1) ì„¤ì •</h2>

        <div class="grid2">
          <div>
            <label>ì°¸ê°€ì ì´ë¦„ (ì‰¼í‘œ/ì¤„ë°”ê¿ˆìœ¼ë¡œ êµ¬ë¶„)</label>
            <textarea id="players" placeholder="ì˜ˆ) ê°€ë¯¼, ë¯¼ì§€, ìˆ˜ì§„"></textarea>
            <div class="muted">íŒ: ì¤„ë°”ê¿ˆ/ì‰¼í‘œ/ìŠ¬ë˜ì‹œ( / ) ë‹¤ ë¨</div>
          </div>
          <div>
            <label>ê¸ˆì§€ì–´ ëª©ë¡ (ì¤„ë°”ê¿ˆìœ¼ë¡œ ì…ë ¥)</label>
            <textarea id="banned" placeholder="ì˜ˆ) ì§„ì§œ
ëŒ€ë°•
ë¯¸ì³¤ë‹¤
ì•„ë‹ˆ
ê·¸ë‹ˆê¹Œ"></textarea>
            <div class="muted">ì¸ì›ë³´ë‹¤ ê¸ˆì§€ì–´ê°€ ì ìœ¼ë©´ ìë™ìœ¼ë¡œ ì¼ë¶€ ì¤‘ë³µë  ìˆ˜ ìˆìŒ</div>
          </div>
        </div>

        <div class="grid2">
          <div>
            <label>ê²Œì„ ì‹œê°„</label>
            <select id="duration">
              <option value="600">10ë¶„</option>
              <option value="900">15ë¶„</option>
              <option value="1200" selected>20ë¶„</option>
              <option value="1800">30ë¶„</option>
              <option value="0">ë¬´ì œí•œ(íƒ€ì´ë¨¸ ì—†ìŒ)</option>
            </select>
          </div>
          <div>
            <label>ë£°ë › ìœ„í—˜ë„(ë²Œì¹™ ê°•ë„)</label>
            <select id="risk">
              <option value="easy">ì•½</option>
              <option value="mid" selected>ì¤‘</option>
              <option value="hard">ê°•</option>
            </select>
          </div>
        </div>

        <div class="btns">
          <button id="btnAssign" class="primary">ê¸ˆì§€ì–´ ë°°ì •í•˜ê¸°</button>
          <button id="btnShuffle">ì¬ë°°ì •(ì…”í”Œ)</button>
          <button id="btnReveal">ë‚´ ê¸ˆì§€ì–´ ë³´ê¸°(ì„ íƒ)</button>
        </div>

        <div class="hr"></div>

        <h2>2) ì§„í–‰</h2>
        <div class="timerBox">
          <div class="t">
            <div class="muted">íƒ€ì´ë¨¸</div>
            <div id="timer" class="time">00:00</div>
          </div>
          <div class="btns" style="margin:0">
            <button id="btnStart" class="good">ì‹œì‘</button>
            <button id="btnPause">ì¼ì‹œì •ì§€</button>
            <button id="btnStop" class="danger">ì¢…ë£Œ</button>
          </div>
        </div>

        <div class="assignWrap" style="margin-top:10px">
          <div>
            <label>ì§€ê¸ˆ ê±¸ë¦° ì‚¬ëŒ(ì„ íƒ)</label>
            <select id="who">
              <option value="">(ì„ íƒ)</option>
            </select>
          </div>
          <div>
            <label>ë¬´ìŠ¨ ì¼ë¡œ ê±¸ë¦¼?</label>
            <select id="why">
              <option value="ê¸ˆì§€ì–´ ë§í•¨" selected>ê¸ˆì§€ì–´ ë§í•¨</option>
              <option value="ê¸ˆì§€í–‰ë™ í•¨">ê¸ˆì§€í–‰ë™ í•¨</option>
              <option value="ì˜ì‹¬ ë°›ìŒ(íˆ¬í‘œë¡œ)">ì˜ì‹¬ ë°›ìŒ(íˆ¬í‘œë¡œ)</option>
              <option value="ê¸°íƒ€">ê¸°íƒ€</option>
            </select>
          </div>
        </div>

        <div class="btns">
          <button id="btnRoulette" class="primary">ğŸ° ë£°ë › ëŒë¦¬ê¸°(ë²Œì¹™)</button>
          <button id="btnLog">ğŸ“Œ ê¸°ë¡ë§Œ ë‚¨ê¸°ê¸°</button>
        </div>

        <div class="result" style="margin-top:10px">
          <div class="headline" id="lastHeadline">ì•„ì§ ë£°ë › ê²°ê³¼ ì—†ìŒ</div>
          <div class="desc" id="lastDesc">â€œë£°ë › ëŒë¦¬ê¸°â€ë¥¼ ëˆ„ë¥´ë©´ ë²Œì¹™ì´ ëœë¤ìœ¼ë¡œ ë‚˜ì™€.</div>
        </div>

        <div class="hr"></div>

        <div class="muted">
          ìš´ì˜ íŒ:
          <span class="pill"><b>1íŒ</b> 10~20ë¶„ ì¶”ì²œ</span>
          <span class="pill"><b>ë²Œì¹™</b> 5~15ê°œë©´ ì¶©ë¶„</span>
          <span class="pill"><b>ì¹˜íŠ¸</b> â€œë‚´ ê¸ˆì§€ì–´ ë³´ê¸°â€ëŠ” ê°ì í°ìœ¼ë¡œ ë³´ê²Œ í•˜ë©´ ê¿€</span>
        </div>
      </section>

      <!-- RIGHT -->
      <section class="card">
        <h2>ë°°ì •í‘œ</h2>
        <div id="assignments" class="list"></div>

        <div class="hr"></div>

        <h2>ê¸°ë¡(ë¡œê·¸)</h2>
        <div class="muted">ëˆ„ê°€ ì–¸ì œ ê±¸ë ¸ëŠ”ì§€ + ë£°ë › ê²°ê³¼ê°€ ìŒ“ì—¬.</div>
        <div style="height:10px"></div>
        <div id="log" class="list"></div>

        <div class="btns">
          <button id="btnClearLog" class="danger">ë¡œê·¸ ë¹„ìš°ê¸°</button>
          <button id="btnExport">ë¡œê·¸ ë³µì‚¬</button>
        </div>
      </section>
    </div>

    <footer>
      <div>ğŸ“Œ ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸°: ë¸Œë¼ìš°ì €ì— ìë™ ì €ì¥ë¨ (<span class="kbd">localStorage</span>)</div>
      <div>ì›í•˜ë©´ ë‹¤ìŒ ë‹¨ê³„ë¡œ: â€œë©€í‹°í° ê°œì¸ ì—´ëŒ ëª¨ë“œâ€, â€œíˆ¬í‘œ ê¸°ëŠ¥â€, â€œë²Œì¹™ ì»¤ìŠ¤í…€ í¸ì§‘ UIâ€, â€œQR ê³µìœ â€ê¹Œì§€ í™•ì¥ ê°€ëŠ¥.</div>
    </footer>
  </div>

  <script>
    // ---------- Helpers ----------
    const $ = (id) => document.getElementById(id);
    const nowStr = () => {
      const d = new Date();
      const pad = (n)=> String(n).padStart(2,"0");
      return `${pad(d.getMonth()+1)}/${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}:${pad(d.getSeconds())}`;
    };
    const splitNames = (s) => s
      .split(/[\n,\/]+/g)
      .map(v => v.trim())
      .filter(Boolean);

    const splitLines = (s) => s
      .split(/\n+/g)
      .map(v => v.trim())
      .filter(Boolean);

    const shuffle = (arr) => {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    };

    const fmtTime = (sec) => {
      sec = Math.max(0, Math.floor(sec));
      const m = Math.floor(sec / 60);
      const s = sec % 60;
      return String(m).padStart(2,'0') + ":" + String(s).padStart(2,'0');
    };

    // ---------- State ----------
    const state = {
      players: [],
      banned: [],
      assign: {},   // {player: word}
      log: [],      // {t, who, why, resultTag, resultText}
      timer: {
        duration: 1200,
        left: 1200,
        running: false,
        interval: null,
        startedAt: null,
        unlimited: false
      },
      risk: "mid"
    };

    // ---------- Roulette pools ----------
    const POOLS = {
      easy: [
        {tag:"warn", text:"ë¬¼ í•œ ì»µ ë§ˆì‹œê¸°"},
        {tag:"warn", text:"ì¹­ì°¬ 3ê°œ í•˜ê¸°"},
        {tag:"warn", text:"ì• êµ 5ì´ˆ í•˜ê¸°"},
        {tag:"warn", text:"ë‹¤ìŒ íŒ ê°„ì‹ ë‹´ë‹¹"},
        {tag:"warn", text:"ë°”ë‹¥ì— ì† ì§šê³  ìŠ¤ì¿¼íŠ¸ 10ê°œ"},
        {tag:"warn", text:"ë…¸ë˜ í•œ ì†Œì ˆ ë¶€ë¥´ê¸°"},
        {tag:"warn", text:"ìµœê·¼ ì‚¬ì§„ 1ì¥ ê³µê°œ(ì›ì¹˜ ì•Šìœ¼ë©´ ëŒ€ì²´ ë²Œì¹™)"},
      ],
      mid: [
        {tag:"bad", text:"(ìˆ  ìˆìœ¼ë©´) í•œ ì” / ì—†ìœ¼ë©´ ë¬¼ í•œ ì»µ ì›ìƒ·"},
        {tag:"bad", text:"ì§„ì‹¤ê²Œì„ ì§ˆë¬¸ 1ê°œ ë°›ê³  ë¬´ì¡°ê±´ ëŒ€ë‹µ"},
        {tag:"bad", text:"ë‹¤ìŒ ë¼ìš´ë“œ ë™ì•ˆ ë§ìˆ˜ ì œí•œ(3ë¬¸ì¥ë§Œ ê°€ëŠ¥)"},
        {tag:"bad", text:"ì´ë¦„ìœ¼ë¡œ 2í–‰ì‹œ"},
        {tag:"bad", text:"íœ´ëŒ€í° ê°¤ëŸ¬ë¦¬ 10ë²ˆì§¸ ì‚¬ì§„ ë³´ì—¬ì£¼ê¸°(ê±°ë¶€ ì‹œ ë²Œì¹™ 2ë°°)"},
        {tag:"bad", text:"ë‹¤ìŒ íŒ ë°°íŒ…(ê°„ì‹/ìŒë£Œ) 2ë°°"},
        {tag:"warn", text:"10ì´ˆ ë™ì•ˆ â€˜ê°ì • ì—†ëŠ” ë‰´ìŠ¤ ì•µì»¤â€™ì²˜ëŸ¼ ë§í•˜ê¸°"},
        {tag:"warn", text:"íŒ”êµ½í˜€í´ê¸° 10ê°œ or í”Œë­í¬ 30ì´ˆ"},
      ],
      hard: [
        {tag:"bad", text:"(ìˆ ) 2ì” / (ë¬´ì•Œì½œ) ë¬¼ 2ì»µ"},
        {tag:"bad", text:"ì¸ìƒ í‘ì—­ì‚¬ 1ê°œ ê³µê°œ"},
        {tag:"bad", text:"ëœë¤ ì—°ë½ì²˜(ì¹œêµ¬/ê°€ì¡± ì œì™¸)ì—ê²Œ â€˜ë­í•´?â€™ ë³´ë‚´ê¸° (ëŒ€ì²´ ë²Œì¹™ ê°€ëŠ¥)"},
        {tag:"bad", text:"ë‹¤ìŒ íŒ â€˜ì¶”ê°€ ê¸ˆì§€ì–´â€™ 1ê°œ ë” ë¶€ì—¬"},
        {tag:"bad", text:"ë‹¤ìŒ 3ë¶„ê°„ ì›ƒìœ¼ë©´ ë²Œì¹™ 1ê°œ ì¶”ê°€"},
        {tag:"bad", text:"ì¦‰ì‹œ íˆ¬í‘œ: ê°€ì¥ ìˆ˜ìƒí•œ ì‚¬ëŒ 1ëª… ì¶”ê°€ ë²Œì¹™"},
        {tag:"warn", text:"ë²Œì¹™ ì  ê°€ 1íšŒ + ì‹¤íŒ¨ ì‹œ ì¶”ê°€"},
      ]
    };

    // ---------- UI Render ----------
    function renderPlayersSelect(){
      const sel = $("who");
      sel.innerHTML = `<option value="">(ì„ íƒ)</option>` + state.players.map(p => `<option value="${escapeHtml(p)}">${escapeHtml(p)}</option>`).join("");
    }

    function renderAssignments(){
      const box = $("assignments");
      const keys = Object.keys(state.assign);
      if(keys.length === 0){
        box.innerHTML = `<div class="muted">ì•„ì§ ë°°ì •ì´ ì—†ì–´. â€œê¸ˆì§€ì–´ ë°°ì •í•˜ê¸°â€ë¥¼ ëˆŒëŸ¬ì¤˜.</div>`;
        return;
      }
      box.innerHTML = keys.map(p => {
        const w = state.assign[p];
        return `
          <div class="item">
            <div class="left">
              <div class="who">${escapeHtml(p)}</div>
              <div class="muted">ê¸ˆì§€ì–´: <b style="color:var(--text)">${escapeHtml(w)}</b></div>
            </div>
            <div class="tag good">ë°°ì •ë¨</div>
          </div>
        `;
      }).join("");
    }

    function renderLog(){
      const box = $("log");
      if(state.log.length === 0){
        box.innerHTML = `<div class="muted">ê¸°ë¡ì´ ì•„ì§ ì—†ì–´. ë£°ë ›ì„ ëŒë¦¬ê±°ë‚˜ ê¸°ë¡ì„ ë‚¨ê²¨ë´.</div>`;
        return;
      }
      box.innerHTML = state.log.slice().reverse().map(e => `
        <div class="item">
          <div class="left">
            <div class="who">${escapeHtml(e.who || "ëˆ„êµ°ê°€")}</div>
            <div class="muted">${escapeHtml(e.t)} Â· ${escapeHtml(e.why || "ì‚¬ìœ  ì—†ìŒ")}</div>
            ${e.resultText ? `<div class="muted">ê²°ê³¼: <b style="color:var(--text)">${escapeHtml(e.resultText)}</b></div>` : ``}
          </div>
          <div class="tag ${escapeHtml(e.resultTag || 'warn')}">${escapeHtml(tagLabel(e.resultTag))}</div>
        </div>
      `).join("");
    }

    function tagLabel(tag){
      if(tag === "bad") return "ë²Œì¹™";
      if(tag === "good") return "ë³´ìƒ";
      return "ê°€ë²¼ì›€";
    }

    function renderTimer(){
      $("timer").textContent = state.timer.unlimited ? "âˆ" : fmtTime(state.timer.left);
    }

    function setLastResult(head, desc){
      $("lastHeadline").textContent = head;
      $("lastDesc").textContent = desc;
    }

    function escapeHtml(str){
      return String(str)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    // ---------- Logic ----------
    function syncFromInputs(){
      state.players = splitNames($("players").value);
      state.banned  = splitLines($("banned").value);
      state.timer.duration = Number($("duration").value);
      state.timer.unlimited = (state.timer.duration === 0);
      state.risk = $("risk").value;
      if(!state.timer.unlimited){
        state.timer.left = state.timer.duration;
      }
      renderPlayersSelect();
    }

    function assignWords(){
      syncFromInputs();
      if(state.players.length < 2){
        alert("ì°¸ê°€ìë¥¼ ìµœì†Œ 2ëª… ì´ìƒ ë„£ì–´ì¤˜!");
        return;
      }
      if(state.banned.length < 1){
        alert("ê¸ˆì§€ì–´ë¥¼ ìµœì†Œ 1ê°œ ì´ìƒ ë„£ì–´ì¤˜!");
        return;
      }

      const players = [...state.players];
      const words = [...state.banned];

      shuffle(players);
      shuffle(words);

      const assign = {};
      for(let i=0; i<players.length; i++){
        // ì¸ì›ì´ ë” ë§ìœ¼ë©´ ë‹¨ì–´ë¥¼ ë‹¤ì‹œ ì„ì–´ì„œ ì¬ì‚¬ìš©
        const w = words[i % words.length];
        assign[players[i]] = w;
      }
      state.assign = assign;

      renderAssignments();
      setLastResult("ë°°ì • ì™„ë£Œ âœ…", "ê°ì ìê¸° ê¸ˆì§€ì–´ë¥¼ í™•ì¸í•˜ê³  ê²Œì„ì„ ì‹œì‘í•´. (ë³´ì—¬ì£¼ê¸° ì‹«ìœ¼ë©´ â€˜ë‚´ ê¸ˆì§€ì–´ ë³´ê¸°â€™ë¡œ í•œ ëª…ì”© í™•ì¸)");
      saveState();
    }

    function reshuffle(){
      if(Object.keys(state.assign).length === 0){
        assignWords();
        return;
      }
      // ê¸°ì¡´ í”Œë ˆì´ì–´/ê¸ˆì§€ì–´ ê·¸ëŒ€ë¡œ ë‹¤ì‹œ ë°°ì •
      const players = Object.keys(state.assign);
      const words = Object.values(state.assign);
      shuffle(players);
      shuffle(words);
      const assign = {};
      for(let i=0; i<players.length; i++){
        assign[players[i]] = words[i % words.length];
      }
      state.assign = assign;
      renderAssignments();
      setLastResult("ì¬ë°°ì • ì™„ë£Œ ğŸ”", "ê°™ì€ ë‹¨ì–´ í’€ë¡œ ë‹¤ì‹œ ì„ì—ˆì–´.");
      saveState();
    }

    function revealPersonal(){
      if(Object.keys(state.assign).length === 0){
        alert("ë¨¼ì € ë°°ì •ì„ í•´ì¤˜!");
        return;
      }
      const name = prompt("ìê¸° ì´ë¦„ì„ ì •í™•íˆ ì…ë ¥í•´ì¤˜ (ë°°ì •í‘œì—ì„œ í™•ì¸ ê°€ëŠ¥)");
      if(!name) return;
      const w = state.assign[name.trim()];
      if(!w){
        alert("ì´ë¦„ì´ ë°°ì •í‘œì— ì—†ì–´. ì² ì í™•ì¸!");
        return;
      }
      alert(`[${name}]ì˜ ê¸ˆì§€ì–´ëŠ”:  "${w}"\n\n(ì´ í™”ë©´ì„ ë‹¤ë¥¸ ì‚¬ëŒì—ê²Œ ë³´ì—¬ì£¼ì§€ ë§ˆ!)`);
    }

    function startTimer(){
      syncFromInputs();
      if(state.timer.running) return;

      state.timer.running = true;
      $("btnStart").disabled = true;

      if(state.timer.unlimited){
        $("timer").textContent = "âˆ";
        return;
      }

      if(state.timer.left <= 0) state.timer.left = state.timer.duration;

      state.timer.interval = setInterval(() => {
        state.timer.left--;
        renderTimer();
        if(state.timer.left <= 0){
          stopTimer();
          setLastResult("íƒ€ì´ë¨¸ ì¢…ë£Œ â°", "ë¼ìš´ë“œ ë! ì •ì‚°í•˜ê³  ë‹¤ìŒ íŒìœ¼ë¡œ ê°€ì.");
          // ì¢…ë£Œ ì‹œ ê°€ë²¼ìš´ ì´ë²¤íŠ¸ ë¡œê·¸
          state.log.push({
            t: nowStr(),
            who: "(ì „ì²´)",
            why: "íƒ€ì´ë¨¸ ì¢…ë£Œ",
            resultTag: "warn",
            resultText: "ë¼ìš´ë“œ ì¢…ë£Œ"
          });
          renderLog();
          saveState();
        }
      }, 1000);

      setLastResult("ê²Œì„ ì‹œì‘ â–¶ï¸", "ê¸ˆì§€ì–´ ë‚˜ì˜¤ë©´ ë°”ë¡œ â€˜ë£°ë › ëŒë¦¬ê¸°â€™!");
      saveState();
    }

    function pauseTimer(){
      if(!state.timer.running) return;
      state.timer.running = false;
      $("btnStart").disabled = false;
      if(state.timer.interval){
        clearInterval(state.timer.interval);
        state.timer.interval = null;
      }
      setLastResult("ì¼ì‹œì •ì§€ â¸ï¸", "ì ê¹ ì‰¬ê³  ë‹¤ì‹œ ì‹œì‘í•´ë„ ë¨.");
      saveState();
    }

    function stopTimer(){
      state.timer.running = false;
      $("btnStart").disabled = false;
      if(state.timer.interval){
        clearInterval(state.timer.interval);
        state.timer.interval = null;
      }
      if(!state.timer.unlimited){
        state.timer.left = state.timer.duration;
        renderTimer();
      }
      saveState();
    }

    function spinRoulette(){
      syncFromInputs();

      const who = $("who").value || "(ë¯¸ì„ íƒ)";
      const why = $("why").value || "ì‚¬ìœ  ì—†ìŒ";
      const pool = POOLS[state.risk] || POOLS.mid;

      // ëŸ¬ì‹œì•ˆ ë£°ë › ëŠë‚Œ: "ì„¸ì´í”„"ë„ ê°€ë” ë‚˜ì˜¤ê²Œ
      const roll = Math.random();
      let result;
      if(state.risk === "easy"){
        result = (roll < 0.15)
          ? {tag:"good", text:"ì„¸ì´í”„! ë©´ì œ ğŸ˜‡"}
          : pool[Math.floor(Math.random()*pool.length)];
      } else if(state.risk === "mid"){
        result = (roll < 0.10)
          ? {tag:"good", text:"ì„¸ì´í”„! ëŒ€ì‹  ë‹¤ìŒ ì‚¬ëŒ ì§€ëª© ğŸ˜"}
          : pool[Math.floor(Math.random()*pool.length)];
      } else {
        result = (roll < 0.06)
          ? {tag:"good", text:"ì„¸ì´í”„! ì˜¤ëŠ˜ ìš´ ë¯¸ì³¤ë‹¤ ğŸ€"}
          : pool[Math.floor(Math.random()*pool.length)];
      }

      setLastResult(`${who} â†’ ${result.text}`, `ì‚¬ìœ : ${why} Â· (${nowStr()})`);

      state.log.push({
        t: nowStr(),
        who,
        why,
        resultTag: result.tag,
        resultText: result.text
      });

      renderLog();
      saveState();
    }

    function logOnly(){
      const who = $("who").value || "(ë¯¸ì„ íƒ)";
      const why = $("why").value || "ì‚¬ìœ  ì—†ìŒ";
      state.log.push({
        t: nowStr(),
        who,
        why,
        resultTag: "warn",
        resultText: ""
      });
      setLastResult("ê¸°ë¡ ì €ì¥ ğŸ“Œ", `${who} / ${why} ë¡œ ê¸°ë¡ë§Œ ë‚¨ê²¼ì–´.`);
      renderLog();
      saveState();
    }

    function clearLog(){
      if(!confirm("ë¡œê·¸ë¥¼ ì „ë¶€ ì§€ìš¸ê¹Œ?")) return;
      state.log = [];
      renderLog();
      setLastResult("ë¡œê·¸ ì´ˆê¸°í™” ğŸ§¹", "ê¸°ë¡ì´ ë¹„ì›Œì¡Œì–´.");
      saveState();
    }

    function exportLog(){
      if(state.log.length === 0){
        alert("ë³µì‚¬í•  ë¡œê·¸ê°€ ì—†ì–´!");
        return;
      }
      const text = state.log.map(e => {
        const r = e.resultText ? ` | ê²°ê³¼: ${e.resultText}` : "";
        return `${e.t} | ${e.who} | ${e.why}${r}`;
      }).join("\n");

      navigator.clipboard?.writeText(text).then(() => {
        alert("ë¡œê·¸ë¥¼ í´ë¦½ë³´ë“œì— ë³µì‚¬í–ˆì–´!");
      }).catch(() => {
        // fallback
        prompt("ì•„ë˜ í…ìŠ¤íŠ¸ë¥¼ ë³µì‚¬í•´ì¤˜:", text);
      });
    }

    // ---------- Persistence ----------
    const KEY = "banword_russian_v1";

    function saveState(){
      const payload = {
        playersText: $("players").value,
        bannedText: $("banned").value,
        duration: $("duration").value,
        risk: $("risk").value,
        assign: state.assign,
        log: state.log,
        timerLeft: state.timer.left
      };
      localStorage.setItem(KEY, JSON.stringify(payload));
    }

    function loadState(){
      const raw = localStorage.getItem(KEY);
      if(!raw){
        alert("ì €ì¥ëœ ë°ì´í„°ê°€ ì—†ì–´!");
        return;
      }
      const p = JSON.parse(raw);
      $("players").value = p.playersText || "";
      $("banned").value = p.bannedText || "";
      if(p.duration != null) $("duration").value = String(p.duration);
      if(p.risk != null) $("risk").value = String(p.risk);

      syncFromInputs();
      state.assign = p.assign || {};
      state.log = p.log || [];
      if(typeof p.timerLeft === "number") state.timer.left = p.timerLeft;

      renderPlayersSelect();
      renderAssignments();
      renderLog();
      renderTimer();
      setLastResult("ë¶ˆëŸ¬ì˜¤ê¸° ì™„ë£Œ âœ…", "ì´ì „ ìƒíƒœë¡œ ë³µêµ¬í–ˆì–´.");
    }

    function resetAll(){
      if(!confirm("ì •ë§ ì´ˆê¸°í™”í• ê¹Œ? ë°°ì •/ë¡œê·¸/ì…ë ¥ ë‹¤ ë‚ ì•„ê°!")) return;

      stopTimer();
      $("players").value = "";
      $("banned").value = "";
      $("duration").value = "1200";
      $("risk").value = "mid";
      state.players = [];
      state.banned = [];
      state.assign = {};
      state.log = [];
      syncFromInputs();
      renderAssignments();
      renderLog();
      renderTimer();
      setLastResult("ì´ˆê¸°í™” ì™„ë£Œ ğŸ§Š", "ìƒˆë¡œ ì‹œì‘í•˜ì.");
      localStorage.removeItem(KEY);
    }

    // ---------- Wire events ----------
    $("btnAssign").addEventListener("click", assignWords);
    $("btnShuffle").addEventListener("click", reshuffle);
    $("btnReveal").addEventListener("click", revealPersonal);

    $("btnStart").addEventListener("click", startTimer);
    $("btnPause").addEventListener("click", pauseTimer);
    $("btnStop").addEventListener("click", stopTimer);

    $("btnRoulette").addEventListener("click", spinRoulette);
    $("btnLog").addEventListener("click", logOnly);

    $("btnClearLog").addEventListener("click", clearLog);
    $("btnExport").addEventListener("click", exportLog);

    $("btnSave").addEventListener("click", () => { saveState(); alert("ì €ì¥í–ˆì–´!"); });
    $("btnLoad").addEventListener("click", loadState);
    $("btnReset").addEventListener("click", resetAll);

    // ---------- Init defaults ----------
    function initDemo(){
      // ê¸°ë³¸ ì˜ˆì‹œê°’ ë„£ì–´ë‘ê¸° (ì²˜ìŒ ì ‘ì†ì¼ ë•Œë§Œ)
      const raw = localStorage.getItem(KEY);
      if(raw) {
        loadState();
        return;
      }
      $("players").value = "ê°€ë¯¼\në¯¼ì§€\nìˆ˜ì§„";
      $("banned").value = "ì§„ì§œ\nëŒ€ë°•\nì•„ë‹ˆ\nê·¸ë‹ˆê¹Œ\në¯¸ì³¤ë‹¤\nì•„ë§ˆë„\nì†”ì§íˆ";
      $("duration").value = "1200";
      $("risk").value = "mid";
      syncFromInputs();
      renderAssignments();
      renderLog();
      renderTimer();
      setLastResult("ì¤€ë¹„ ì™„ë£Œ ğŸ‰", "ì°¸ê°€ì/ê¸ˆì§€ì–´ ì…ë ¥ â†’ â€˜ê¸ˆì§€ì–´ ë°°ì •í•˜ê¸°â€™ â†’ ì‹œì‘!");
    }
    initDemo();
  </script>
</body>
</html>
